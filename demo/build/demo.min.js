!function a(b,c,d){function e(g,h){if(!c[g]){if(!b[g]){var i="function"==typeof require&&require;if(!h&&i)return i(g,!0);if(f)return f(g,!0);var j=new Error("Cannot find module '"+g+"'");throw j.code="MODULE_NOT_FOUND",j}var k=c[g]={exports:{}};b[g][0].call(k.exports,function(a){var c=b[g][1][a];return e(c?c:a)},k,k.exports,a,b,c,d)}return c[g].exports}for(var f="function"==typeof require&&require,g=0;g<d.length;g++)e(d[g]);return e}({1:[function(a,b,c){var d,e,f,g;g=a("../../src"),d=g.connection.Connection,e=g.pubsub.Publisher,f=g.pubsub.Subscriber,$(function(){var a,b,c,g,h,i,j,k,l;return c=$("#inputForm"),g=$("#input"),h=$("#output"),b=new d("ws://localhost:8765"),j=new e(b),l=new f(b),i=function(a){var b;return b=$("<div>"),b.text(a),h.append(b),h.scrollTop(h[0].scrollHeight),h.find("*").length>50?h.find(":first-child").remove():void 0},a=function(){return i("* connecting"),b.connect({foo:"bar"})},k=function(){return i("* reconnecting in 5 seconds"),setTimeout(a,5e3)},g.focus(),b.on("connect",function(){var a;return i("* connected"),a=l.subscribe("*"),a.on("message",function(a,b){return i("<"+a+"> "+JSON.stringify(b))}),a.enable()}),b.on("error",function(a){return i("* error: "+a),k()}),b.on("disconnect",function(a,b){return i("* disconnected: "+a+" "+b),k()}),c.submit(function(a){return a.preventDefault(),j.publish("websocket",{text:g.val()}),g.val("")}),a()})},{"../../src":51}],2:[function(a,b,c){"use strict";b.exports=function(a){function b(a){var b=new c(a),d=b.promise();return d.isRejected()?d:(b.setHowMany(1),b.setUnwrap(),b.init(),d)}var c=a._SomePromiseArray;a.any=function(a){return b(a)},a.prototype.any=function(){return b(this)}}},{}],3:[function(a,b,c){(function(c){"use strict";function d(){this._isTickUsed=!1,this._lateQueue=new g(16),this._normalQueue=new g(65536);var a=this;this.drainQueues=function(){a._drainQueues()},this._schedule=f.isStatic?f(this.drainQueues):f}var e=new Error,f=a("./schedule.js"),g=a("./queue.js"),h="undefined"!=typeof c?c:void 0;d.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},d.prototype._withDomain=function(a){return void 0===h||null==h.domain||a.domain||(a=h.domain.bind(a)),a},d.prototype.throwLater=function(a,b){if(1===arguments.length&&(b=a,a=function(){throw b}),a=this._withDomain(a),"undefined"!=typeof setTimeout)setTimeout(function(){a(b)},0);else try{this._schedule(function(){a(b)})}catch(c){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},d.prototype.invokeLater=function(a,b,c){a=this._withDomain(a),this._lateQueue.push(a,b,c),this._queueTick()},d.prototype.invokeFirst=function(a,b,c){a=this._withDomain(a),this._normalQueue.unshift(a,b,c),this._queueTick()},d.prototype.invoke=function(a,b,c){a=this._withDomain(a),this._normalQueue.push(a,b,c),this._queueTick()},d.prototype._drainQueue=function(a){for(;a.length()>0;){var b=a.shift(),c=a.shift(),d=a.shift();b.call(c,d)}},d.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},d.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},d.prototype._reset=function(){this._isTickUsed=!1},b.exports=new d,b.exports.firstLineError=e}).call(this,a("_process"))},{"./queue.js":26,"./schedule.js":29,_process:40}],4:[function(a,b,c){"use strict";function d(a){try{Promise===a&&(Promise=e)}catch(b){}return a}var e;"undefined"!=typeof Promise&&(e=Promise),b.exports=a("./promise.js")(),b.exports.noConflict=d},{"./promise.js":21}],5:[function(a,b,c){"use strict";var d=Object.create;if(d){var e=d(null),f=d(null);e[" size"]=f[" size"]=0}b.exports=function(b){function c(a){return new Function("obj","                                             \n        'use strict'                                                         \n        var len = this.length;                                               \n        switch(len) {                                                        \n            case 1: return obj.methodName(this[0]);                          \n            case 2: return obj.methodName(this[0], this[1]);                 \n            case 3: return obj.methodName(this[0], this[1], this[2]);        \n            case 0: return obj.methodName();                                 \n            default: return obj.methodName.apply(obj, this);                 \n        }                                                                    \n        ".replace(/methodName/g,a))}function d(a){return new Function("obj","                                             \n        'use strict';                                                        \n        return obj.propertyName;                                             \n        ".replace("propertyName",a))}function g(a,b,c){var d=c[a];if("function"!=typeof d){if(!o(a))return null;if(d=b(a),c[a]=d,c[" size"]++,c[" size"]>512){for(var e=Object.keys(c),f=0;256>f;++f)delete c[e[f]];c[" size"]=e.length-256}}return d}function h(a){return g(a,c,e)}function i(a){return g(a,d,f)}function j(a){return a[this.pop()].apply(a,this)}function k(a){return a[this]}function l(a){var b=+this;return 0>b&&(b=Math.max(0,b+a.length)),a[b]}var m=a("./util.js"),n=m.canEvaluate,o=m.isIdentifier;b.prototype.call=function(a){for(var b=arguments.length,c=new Array(b-1),d=1;b>d;++d)c[d-1]=arguments[d];if(n){var e=h(a);if(null!==e)return this._then(e,void 0,void 0,c,void 0)}return c.push(a),this._then(j,void 0,void 0,c,void 0)},b.prototype.get=function(a){var b,c="number"==typeof a;if(c)b=l;else if(n){var d=i(a);b=null!==d?d:k}else b=k;return this._then(b,void 0,void 0,a,void 0)}}},{"./util.js":36}],6:[function(a,b,c){"use strict";b.exports=function(b,c){var d=a("./errors.js"),e=d.canAttachTrace,f=a("./async.js"),g=a("./util.js"),h=d.CancellationError;b.prototype._cancel=function(a){if(!this.isCancellable())return this;for(var b,c=this;void 0!==(b=c._cancellationParent)&&b.isCancellable();)c=b;this._unsetCancellable();var d=e(a)?a:new Error(g.toString(a));c._attachExtraTrace(d),c._target()._rejectUnchecked(a,d)},b.prototype.cancel=function(a){return this.isCancellable()?(void 0===a&&(a=new h),f.invokeLater(this._cancel,this,a),this):this},b.prototype.cancellable=function(){return this._cancellable()?this:(this._setCancellable(),this._cancellationParent=void 0,this)},b.prototype.uncancellable=function(){var a=new b(c);return a._propagateFrom(this,6),a._follow(this),a._unsetCancellable(),a},b.prototype.fork=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);return d._setCancellable(),d._cancellationParent=void 0,d}}},{"./async.js":3,"./errors.js":11,"./util.js":36}],7:[function(a,b,c){"use strict";b.exports=function(){function b(a){this._parent=a,l(this,b)}function c(a){var b;if("function"==typeof a)b="[function "+(a.name||"anonymous")+"]";else{b=a.toString();var c=/\[object [a-zA-Z0-9$_]+\]/;if(c.test(b))try{var e=JSON.stringify(a);b=e}catch(f){}0===b.length&&(b="(empty array)")}return"(<"+d(b)+">, no stack trace)"}function d(a){var b=41;return a.length<b?a:a.substr(0,b-3)+"..."}function e(a){var b=a.match(k);return b?{fileName:b[1],line:parseInt(b[2],10)}:void 0}var f=a("./util.js").inherits,g=a("./es5.js").defineProperty,h=null,i=null;f(b,Error),b.prototype.parent=function(){return this._parent},b.prototype.setParent=function(a){a!==this&&(this._parent=a)},b.prototype.hasParent=function(){return void 0!==this._parent},b.prototype.attachExtraTrace=function(a){var b=this,c=a.stack;c="string"==typeof c?c.split("\n"):[],this.protectErrorMessageNewlines(c);var d=1,e=1;do c=b.combine(c),e++;while(null!=(b=b.parent()));var f=Error.stackTraceLimit||10,g=(f+d)*e,h=c.length;h>g&&(c.length=g),h>0&&(c[0]=c[0].split("\x00").join("\n")),c.length<=d?a.stack="(No stack trace)":a.stack=c.join("\n")},b.prototype.combine=function(a){for(var b=this.stack.split("\n"),c=a.length-1,d=a[c],e=-1,f=b.length-1;f>=0;--f)if(b[f]===d){e=f;break}for(var f=e;f>=0;--f){var g=b[f];if(a[c]!==g)break;a.pop(),c--}a.push("From previous event:");for(var i=a.concat(b),k=[],f=0,l=i.length;l>f;++f)h.test(i[f])&&j(i[f])||f>0&&!h.test(i[f])&&"From previous event:"!==i[f]||k.push(i[f]);return k},b.prototype.protectErrorMessageNewlines=function(a){for(var b=0;b<a.length&&!h.test(a[b]);++b);if(!(1>=b)){for(var c=[],d=0;b>d;++d)c.push(a.shift());a.unshift(c.join("\x00"))}},b.formatAndLogError=function(a,b){if("object"==typeof console){var c;if("object"==typeof a||"function"==typeof a){var d=a.stack;c=b+i(d,a)}else c=b+String(a);"function"==typeof console.warn||"object"==typeof console.warn?console.warn(c):("function"==typeof console.log||"object"==typeof console.log)&&console.log(c)}},b.unhandledRejection=function(a){b.formatAndLogError(a,"^--- With additional stack trace: ")},b.possiblyUnhandledRejection=function(a){b.formatAndLogError(a,"Possibly unhandled ")},b.isSupported=function(){return"function"==typeof l};var j=function(){return!1},k=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;b.setBounds=function(a,c){if(b.isSupported()){for(var d,f,g=a.stack.split("\n"),h=c.stack.split("\n"),i=-1,k=-1,l=0;l<g.length;++l){var m=e(g[l]);if(m){d=m.fileName,i=m.line;break}}for(var l=0;l<h.length;++l){var m=e(h[l]);if(m){f=m.fileName,k=m.line;break}}0>i||0>k||!d||!f||d!==f||i>=k||(j=function(a){var b=e(a);return b&&b.fileName===d&&i<=b.line&&b.line<=k?!0:!1})}};var l=function m(){if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){h=/^\s*at\s*/,i=function(a,b){return"string"==typeof a?a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:c(b)};var a=Error.captureStackTrace,b=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo)/;return j=function(a){return b.test(a)},function(b,c){a(b,c)}}var d=new Error;if("string"==typeof d.stack&&"function"==typeof"".startsWith&&d.stack.startsWith("stackDetection@")&&"stackDetection"===m.name){g(Error,"stackTraceLimit",{writable:!0,enumerable:!1,configurable:!1,value:25}),h=/@/;var e=/[@\n]/;return i=function(a,b){return"string"==typeof a?b.name+". "+b.message+"\n"+a:void 0!==b.name&&void 0!==b.message?b.name+". "+b.message:c(b)},function(a){for(var b=(new Error).stack,c=b.split(e),d=c.length,f="",g=0;d>g;g+=2)f+=c[g],f+="@",f+=c[g+1],f+="\n";a.stack=f}}return i=function(a,b){return"string"==typeof a?a:"object"!=typeof b&&"function"!=typeof b||void 0===b.name||void 0===b.message?c(b):b.name+". "+b.message},null}();return b}},{"./es5.js":13,"./util.js":36}],8:[function(a,b,c){"use strict";b.exports=function(b){function c(a,b,c){this._instances=a,this._callback=b,this._promise=c}function d(a,b){var c={},d=g(a,c,b);if(d===h)return d;var e=i(c);return e.length?(h.e=new j("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),h):d}var e=a("./util.js"),f=a("./errors.js"),g=e.tryCatch1,h=e.errorObj,i=a("./es5.js").keys,j=f.TypeError;return c.prototype.doFilter=function(a){for(var c=this._callback,i=this._promise,j=i._boundTo,k=0,l=this._instances.length;l>k;++k){var m=this._instances[k],n=m===Error||null!=m&&m.prototype instanceof Error;if(n&&a instanceof m){var o=g(c,j,a);return o===h?(b.e=o.e,b):o}if("function"==typeof m&&!n){var p=d(m,a);if(p===h){var q=f.canAttachTrace(h.e)?h.e:new Error(e.toString(h.e));this._promise._attachExtraTrace(q),a=h.e;break}if(p){var o=g(c,j,a);return o===h?(b.e=o.e,b):o}}}return b.e=a,b},c}},{"./errors.js":11,"./es5.js":13,"./util.js":36}],9:[function(a,b,c){"use strict";var d=a("./util.js"),e=d.isPrimitive,f=d.wrapsPrimitiveReceiver;b.exports=function(a){var b=function(){return this},c=function(){throw this},d=function(a,b){return 1===b?function(){throw a}:2===b?function(){return a}:void 0};a.prototype["return"]=a.prototype.thenReturn=function(a){return f&&e(a)?this._then(d(a,2),void 0,void 0,void 0,void 0):this._then(b,void 0,void 0,a,void 0)},a.prototype["throw"]=a.prototype.thenThrow=function(a){return f&&e(a)?this._then(d(a,1),void 0,void 0,void 0,void 0):this._then(c,void 0,void 0,a,void 0)}}},{"./util.js":36}],10:[function(a,b,c){"use strict";b.exports=function(a,b){var c=a.reduce;a.prototype.each=function(a){return c(this,a,null,b)},a.each=function(a,d){return c(a,d,null,b)}}},{}],11:[function(a,b,c){"use strict";function d(a){try{p(a,"isOperational",!0)}catch(b){}}function e(a){return null==a?!1:a instanceof i||a.isOperational===!0}function f(a){return a instanceof Error}function g(a){return f(a)&&m(a,"stack")}function h(a,b){function c(d){return this instanceof c?(p(this,"message","string"==typeof d?d:b),p(this,"name",a),void(Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new c(d)}return o(c,Error),c}function i(a){p(this,"name","OperationalError"),p(this,"message",a),this.cause=a,this.isOperational=!0,a instanceof Error?(p(this,"message",a.message),p(this,"stack",a.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor)}var j,k,l=a("./es5.js").freeze,m=a("./es5.js").propertyIsWritable,n=a("./util.js"),o=n.inherits,p=n.notEnumerableProp,q=h("CancellationError","cancellation error"),r=h("TimeoutError","timeout error"),s=h("AggregateError","aggregate error");try{j=TypeError,k=RangeError}catch(t){j=h("TypeError","type error"),k=h("RangeError","range error")}for(var u="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),v=0;v<u.length;++v)"function"==typeof Array.prototype[u[v]]&&(s.prototype[u[v]]=Array.prototype[u[v]]);s.prototype.length=0,s.prototype.isOperational=!0;var w=0;s.prototype.toString=function(){var a=Array(4*w+1).join(" "),b="\n"+a+"AggregateError of:\n";w++,a=Array(4*w+1).join(" ");for(var c=0;c<this.length;++c){for(var d=this[c]===this?"[Circular AggregateError]":this[c]+"",e=d.split("\n"),f=0;f<e.length;++f)e[f]=a+e[f];d=e.join("\n"),b+=d+"\n"}return w--,b},o(i,Error);var x="__BluebirdErrorTypes__",y=Error[x];y||(y=l({CancellationError:q,TimeoutError:r,OperationalError:i,RejectionError:i,AggregateError:s}),p(Error,x,y)),b.exports={Error:Error,TypeError:j,RangeError:k,CancellationError:y.CancellationError,OperationalError:y.OperationalError,TimeoutError:y.TimeoutError,AggregateError:y.AggregateError,originatesFromRejection:e,markAsOriginatingFromRejection:d,canAttachTrace:g}},{"./es5.js":13,"./util.js":36}],12:[function(a,b,c){"use strict";b.exports=function(b){function c(a){var c=new d(a),e=b.rejected(c),f=e._peekContext();return null!=f&&f.attachExtraTrace(c),e}var d=a("./errors.js").TypeError;return c}},{"./errors.js":11}],13:[function(a,b,c){var d=function(){"use strict";return void 0===this}();if(d)b.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,keys:Object.keys,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:d,propertyIsWritable:function(a,b){var c=Object.getOwnPropertyDescriptor(a,b);return!(c&&!c.writable&&!c.set)}};else{var e={}.hasOwnProperty,f={}.toString,g={}.constructor.prototype,h=function(a){var b=[];for(var c in a)e.call(a,c)&&b.push(c);return b},i=function(a,b,c){return a[b]=c.value,a},j=function(a){return a},k=function(a){try{return Object(a).constructor.prototype}catch(b){return g}},l=function(a){try{return"[object Array]"===f.call(a)}catch(b){return!1}};b.exports={isArray:l,keys:h,defineProperty:i,freeze:j,getPrototypeOf:k,isES5:d,propertyIsWritable:function(){return!0}}}},{}],14:[function(a,b,c){"use strict";b.exports=function(a,b){var c=a.map;a.prototype.filter=function(a,d){return c(this,a,d,b)},a.filter=function(a,d,e){return c(a,d,e,b)}}},{}],15:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(){return this}function f(){throw this}function g(a){return function(){return a}}function h(a){return function(){throw a}}function i(a,b,c){var d;return d=m&&n(b)?c?g(b):h(b):c?e:f,a._then(d,o,void 0,b,void 0)}function j(a){var e=this.promise,f=this.handler,g=e._isBound()?f.call(e._boundTo):f();if(void 0!==g){var h=d(g,void 0);if(h instanceof b)return h=h._target(),i(h,a,e.isFulfilled())}return e.isRejected()?(c.e=a,c):a}function k(a){var c=this.promise,e=this.handler,f=c._isBound()?e.call(c._boundTo,a):e(a);if(void 0!==f){var g=d(f,void 0);if(g instanceof b)return g=g._target(),i(g,a,!0)}return a}var l=a("./util.js"),m=l.wrapsPrimitiveReceiver,n=l.isPrimitive,o=l.thrower;b.prototype._passThroughHandler=function(a,b){if("function"!=typeof a)return this.then();var c={promise:this,handler:a};return this._then(b?j:k,b?j:void 0,void 0,c,void 0)},b.prototype.lastly=b.prototype["finally"]=function(a){return this._passThroughHandler(a,!0)},b.prototype.tap=function(a){return this._passThroughHandler(a,!1)}}},{"./util.js":36}],16:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function f(a,c,d){for(var f=l,g=b,h=c.length,i=0;h>i;++i){var j=m(c[i],void 0,a);if(j===f)return g.reject(f.e);var k=e(j,d);if(k instanceof g)return k}return null}function g(a,c,e){var f=this._promise=new b(d);f._setTrace(void 0),this._generatorFunction=a,this._receiver=c,this._generator=void 0,this._yieldHandlers="function"==typeof e?[e].concat(n):n}var h=a("./errors.js"),i=h.TypeError,j=a("./util.js").deprecated,k=a("./util.js"),l=k.errorObj,m=k.tryCatch1,n=[];g.prototype.promise=function(){return this._promise},g.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},g.prototype._continue=function(a){if(a===l){this._generator=void 0;var c=h.canAttachTrace(a.e)?a.e:new Error(k.toString(a.e));return this._promise._attachExtraTrace(c),void this._promise._reject(a.e,c)}var d=a.value;if(a.done===!0)this._generator=void 0,this._promise._tryFollow(d)||this._promise._fulfill(d);else{var g=e(d,this._promise);if(!(g instanceof b)&&(g=f(g,this._yieldHandlers,this._promise),null===g))return void this._throw(new i("A value was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n"));g._then(this._next,this._throw,void 0,this,null)}},g.prototype._throw=function(a){h.canAttachTrace(a)&&this._promise._attachExtraTrace(a),this._continue(m(this._generator["throw"],this._generator,a))},g.prototype._next=function(a){this._continue(m(this._generator.next,this._generator,a))},b.coroutine=function(a,b){if("function"!=typeof a)throw new i("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var c=Object(b).yieldHandler,d=g;return function(){var b=a.apply(this,arguments),e=new d(void 0,void 0,c);return e._generator=b,e._next(void 0),e.promise()}},b.coroutine.addYieldHandler=function(a){if("function"!=typeof a)throw new i("fn must be a function\n\n    See http://goo.gl/916lJJ\n");n.push(a)},b.spawn=function(a){if(j("Promise.spawn is deprecated. Use Promise.coroutine instead."),"function"!=typeof a)return c("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var d=new g(a,this),e=d.promise();return d._run(b.spawn),e}}},{"./errors.js":11,"./util.js":36}],17:[function(a,b,c){"use strict";b.exports=function(b,c,d,e){function f(a){this._reject(a)}var g=a("./util.js"),h=g.canEvaluate,i=g.tryCatch1,j=g.errorObj;if(h){for(var k=function(a){return new Function("value","holder","                             \n            'use strict';                                                    \n            holder.pIndex = value;                                           \n            holder.checkFulfillment(this);                                   \n            ".replace(/Index/g,a))},l=function(a){for(var b=[],c=1;a>=c;++c)b.push("holder.p"+c);return new Function("holder","                                      \n            'use strict';                                                    \n            var callback = holder.fn;                                        \n            return callback(values);                                         \n            ".replace(/values/g,b.join(", ")))},m=[],n=[void 0],o=1;5>=o;++o)m.push(k(o)),n.push(l(o));var p=function(a,b){this.p1=this.p2=this.p3=this.p4=this.p5=null,this.fn=b,this.total=a,this.now=0};p.prototype.callers=n,p.prototype.checkFulfillment=function(a){var b=this.now;b++;var c=this.total;if(b>=c){var d=this.callers[c],e=i(d,void 0,this);e===j?a._rejectUnchecked(e.e):a._tryFollow(e)||a._fulfillUnchecked(e)}else this.now=b}}b.join=function(){var a,g=arguments.length-1;if(g>0&&"function"==typeof arguments[g]&&(a=arguments[g],6>g&&h)){var i=new b(e);i._setTrace(void 0);for(var j=new p(g,a),k=m,l=0;g>l;++l){var n=d(arguments[l],void 0);n instanceof b?(n=n._target(),n._isPending()?n._then(k[l],f,void 0,i,j):n._isFulfilled()?k[l].call(i,n._value(),j):(i._reject(n._reason()),n._unsetRejectionIsUnhandled())):k[l].call(i,n,j)}return i}for(var o=arguments.length,q=new Array(o),r=0;o>r;++r)q[r]=arguments[r];var i=new c(q).promise();return void 0!==a?i.spread(a):i}}},{"./util.js":36}],18:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){function g(a,b,c,d){this.constructor$(a),this._callback=b,this._preservedValues=d===f?new Array(this.length()):null,this._limit=c,this._inFlight=0,this._queue=c>=1?[]:m,this._init$(void 0,-2)}function h(a,b,c,d){var e="object"==typeof c&&null!==c?c.concurrency:0;return e="number"==typeof e&&isFinite(e)&&e>=1?e:0,new g(a,b,e,d)}var i=a("./util.js"),j=i.tryCatch3,k=i.errorObj,l={},m=[];i.inherits(g,c),g.prototype._init=function(){},g.prototype._promiseFulfilled=function(a,c){var d=this._values,f=this.length(),g=this._preservedValues,h=this._limit;if(d[c]===l){if(d[c]=a,h>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(h>=1&&this._inFlight>=h)return d[c]=a,void this._queue.push(c);null!==g&&(g[c]=a);var i=this._callback,m=this._promise._boundTo,n=j(i,m,a,c,f);if(n===k)return this._reject(n.e);var o=e(n,this._promise);if(o instanceof b){if(o=o._target(),o._isPending())return h>=1&&this._inFlight++,d[c]=l,o._proxyPromiseArray(this,c);if(!o._isFulfilled())return o._unsetRejectionIsUnhandled(),this._reject(o._reason());n=o._value()}d[c]=n}var p=++this._totalResolved;p>=f&&(null!==g?this._filter(d,g):this._resolve(d))},g.prototype._drainQueue=function(){for(var a=this._queue,b=this._limit,c=this._values;a.length>0&&this._inFlight<b;){if(this._isResolved())return;var d=a.pop();this._promiseFulfilled(c[d],d)}},g.prototype._filter=function(a,b){for(var c=b.length,d=new Array(c),e=0,f=0;c>f;++f)a[f]&&(d[e++]=b[f]);d.length=e,this._resolve(d)},g.prototype.preservedValues=function(){return this._preservedValues},b.prototype.map=function(a,b){return"function"!=typeof a?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(this,a,b,null).promise()},b.map=function(a,b,c,e){return"function"!=typeof b?d("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):h(a,b,c,e).promise()}}},{"./util.js":36}],19:[function(a,b,c){"use strict";b.exports=function(b){function c(a,b){if(!f.isArray(a))return d(a,b);var c=f.tryCatchApply(this,[null].concat(a),b);c===j&&g.throwLater(c.e)}function d(a,b){var c=this,d=void 0===a?i(c,b,null):h(c,b,null,a);d===j&&g.throwLater(d.e)}function e(a,b){var c=this,d=i(c,b,a);d===j&&g.throwLater(d.e)}var f=a("./util.js"),g=a("./async.js"),h=f.tryCatch2,i=f.tryCatch1,j=f.errorObj;b.prototype.nodeify=function(a,b){if("function"==typeof a){var f=d;void 0!==b&&Object(b).spread&&(f=c),this._then(f,e,void 0,a,this._boundTo)}return this}}},{"./async.js":3,"./util.js":36}],20:[function(a,b,c){"use strict";b.exports=function(b,c){var d=a("./util.js"),e=a("./async.js"),f=a("./errors.js"),g=d.tryCatch1,h=d.errorObj;b.prototype.progressed=function(a){return this._then(void 0,void 0,a,void 0,void 0)},b.prototype._progress=function(a){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(a)},b.prototype._progressHandlerAt=function(a){return 0===a?this._progressHandler0:this[(a<<2)+a-5+2]},b.prototype._doProgressWith=function(a){var c=a.value,e=a.handler,i=a.promise,j=a.receiver,k=g(e,j,c);if(k===h){if(null!=k.e&&"StopProgressPropagation"!==k.e.name){var l=f.canAttachTrace(k.e)?k.e:new Error(d.toString(k.e));i._attachExtraTrace(l),i._progress(k.e)}}else k instanceof b?k._then(i._progress,null,null,i,void 0):i._progress(k)},b.prototype._progressUnchecked=function(a){for(var d=this._length(),f=this._progress,g=0;d>g;g++){var h=this._progressHandlerAt(g),i=this._promiseAt(g);if(i instanceof b)"function"==typeof h?e.invoke(this._doProgressWith,this,{handler:h,promise:i,receiver:this._receiverAt(g),value:a}):e.invoke(f,i,a);else{var j=this._receiverAt(g);"function"==typeof h?h.call(j,a,i):j instanceof c&&!j._isResolved()&&j._promiseProgressed(a,i)}}}}},{"./async.js":3,"./errors.js":11,"./util.js":36}],21:[function(a,b,c){(function(c){"use strict";b.exports=function(){function b(a){if("function"!=typeof a)throw new x("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==b)throw new x("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,this._boundTo=void 0,a!==j&&this._resolveFromResolver(a)}var d,e=function(){return new x("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},f=function(){return new b.PromiseInspection(this._target())},g=a("./util.js"),h=a("./async.js"),i=a("./errors.js"),j=function(){},k={},l={e:null},m=a("./thenables.js")(b,j),n=a("./promise_array.js")(b,j,m),o=a("./captured_trace.js")(),p=a("./catch_filter.js")(l),q=a("./promise_resolver.js"),r=g.isArray,s=g.errorObj,t=g.tryCatch1,u=g.tryCatch2,v=g.tryCatchApply,w=i.RangeError,x=i.TypeError,y=i.CancellationError,z=i.TimeoutError,A=i.OperationalError,B=i.originatesFromRejection,C=i.markAsOriginatingFromRejection,D=i.canAttachTrace,E=a("./errors_api_rejection")(b),F=!1||!("undefined"==typeof c||"string"!=typeof c.execPath||"object"!=typeof c.env||!c.env.BLUEBIRD_DEBUG&&"development"!==c.env.NODE_ENV);b.prototype.bind=function(a){var c=m(a,this),d=new b(j);d._propagateFrom(this,3);var e=this._target();return c instanceof b?(e._then(j,d._reject,d._progress,d,null),c._then(function(a){d._isPending()&&(d._setBoundTo(a),d._follow(e))},d._reject,d._progress,d,null)):(d._setBoundTo(a),d._follow(e)),d},b.prototype.toString=function(){return"[object Promise]"},b.prototype.caught=b.prototype["catch"]=function(a){var c=arguments.length;if(c>1){var d,e=new Array(c-1),f=0;for(d=0;c-1>d;++d){var g=arguments[d];if("function"!=typeof g){var h=new x("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n");return this._attachExtraTrace(h),b.reject(h)}e[f++]=g}e.length=f,a=arguments[d],this._resetTrace();var i=new p(e,a,this);return this._then(void 0,i.doFilter,void 0,i,void 0)}return this._then(void 0,a,void 0,void 0,void 0)},b.prototype.reflect=function(){return this._then(f,f,void 0,this,void 0)},b.prototype.then=function(a,b,c){return this._then(a,b,c,void 0,void 0)},b.prototype.done=function(a,b,c){var d=this._then(a,b,c,void 0,void 0);d._setIsFinal()},b.prototype.spread=function(a,b){return this.all()._then(a,b,void 0,k,void 0)},b.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},b.prototype.toJSON=function(){var a={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(a.fulfillmentValue=this.value(),a.isFulfilled=!0):this.isRejected()&&(a.rejectionReason=this.reason(),a.isRejected=!0),a},b.prototype.all=function(){return new n(this).promise()},b.prototype.error=function(a){return this.caught(B,a)},b.is=function(a){return a instanceof b},b.all=function(a){return new n(a).promise()},b.method=function(a){if("function"!=typeof a)throw new x("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var c;switch(arguments.length){case 0:c=t(a,this,void 0);break;case 1:c=t(a,this,arguments[0]);break;case 2:c=u(a,this,arguments[0],arguments[1]);break;default:for(var d=arguments.length,e=new Array(d),f=0;d>f;++f)e[f]=arguments[f];c=v(a,e,this)}var g=new b(j);return g._setTrace(void 0),g._resolveFromSyncValue(c),g}},b.attempt=b["try"]=function(a,c,d){if("function"!=typeof a)return E("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var e=r(c)?v(a,c,d):t(a,d,c),f=new b(j);return f._setTrace(void 0),f._resolveFromSyncValue(e),f},b.defer=b.pending=function(){var a=new b(j);return a._setTrace(void 0),new q(a)},b.bind=function(a){var c=m(a,void 0),d=new b(j);return d._setTrace(void 0),c instanceof b?c._then(function(a){d._setBoundTo(a),d._fulfill(void 0)},d._reject,d._progress,d,null):(d._setBoundTo(a),d._setFulfilled()),d},b.cast=function(a){var c=m(a,void 0);if(!(c instanceof b)){var d=c;c=new b(j),c._setTrace(void 0),c._setFulfilled(),c._settledValue=d,c._cleanValues()}return c},b.resolve=b.fulfilled=b.cast,b.reject=b.rejected=function(a){var c=new b(j);if(c._setTrace(void 0),C(a),c._setRejected(),c._settledValue=a,c._cleanValues(),!D(a)){var d=new Error(g.toString(a));c._setCarriedStackTrace(d)}return c._ensurePossibleRejectionHandled(),c},b.onPossiblyUnhandledRejection=function(a){o.possiblyUnhandledRejection="function"==typeof a?a:void 0},b.onUnhandledRejectionHandled=function(a){d="function"==typeof a?a:void 0},b.longStackTraces=function(){if(h.haveItemsQueued()&&F===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");F=o.isSupported()},b.hasLongStackTraces=function(){return F&&o.isSupported()},b.setScheduler=function(a){if("function"!=typeof a)throw new x("fn must be a function\n\n    See http://goo.gl/916lJJ\n");h._schedule=a},b.prototype._then=function(a,c,d,e,f){var g=void 0!==f,i=g?f:new b(j);g||i._propagateFrom(this,7);var k=this._target();k!==this&&(void 0===e&&(e=this._boundTo),g||i._setIsMigrated());var l=k._addCallbacks(a,c,d,i,e);return k._isResolved()&&!k._isSettlePromisesQueued()&&h.invoke(k._settlePromiseAtPostResolution,k,l),i},b.prototype._settlePromiseAtPostResolution=function(a){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(a)},b.prototype._length=function(){return 262143&this._bitField},b.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},b.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},b.prototype._setLength=function(a){this._bitField=-262144&this._bitField|262143&a},b.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},b.prototype._setRejected=function(){this._bitField=134217728|this._bitField},b.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},b.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},b.prototype._isFinal=function(){return(33554432&this._bitField)>0},b.prototype._cancellable=function(){return(67108864&this._bitField)>0},b.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},b.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},b.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},b.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},b.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},b.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},b.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},b.prototype._isMigrated=function(){return(4194304&this._bitField)>0},b.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},b.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},b.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},b.prototype._setCarriedStackTrace=function(a){this._bitField=1048576|this._bitField,
this._fulfillmentHandler0=a},b.prototype._unsetCarriedStackTrace=function(){this._bitField=-1048577&this._bitField,this._fulfillmentHandler0=void 0},b.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},b.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},b.prototype._receiverAt=function(a){var b=0===a?this._receiver0:this[5*a-5+4];return this._isBound()&&void 0===b?this._boundTo:b},b.prototype._promiseAt=function(a){return 0===a?this._promise0:this[5*a-5+3]},b.prototype._fulfillmentHandlerAt=function(a){return 0===a?this._fulfillmentHandler0:this[5*a-5+0]},b.prototype._rejectionHandlerAt=function(a){return 0===a?this._rejectionHandler0:this[5*a-5+1]},b.prototype._migrateCallbacks=function(a,c,d,e,f){e instanceof b&&e._setIsMigrated(),this._addCallbacks(a,c,d,e,f)},b.prototype._addCallbacks=function(a,b,c,d,e){var f=this._length();if(f>=262138&&(f=0,this._setLength(0)),0===f)this._promise0=d,void 0!==e&&(this._receiver0=e),"function"!=typeof a||this._isCarryingStackTrace()||(this._fulfillmentHandler0=a),"function"==typeof b&&(this._rejectionHandler0=b),"function"==typeof c&&(this._progressHandler0=c);else{var g=5*f-5;this[g+3]=d,this[g+4]=e,"function"==typeof a&&(this[g+0]=a),"function"==typeof b&&(this[g+1]=b),"function"==typeof c&&(this[g+2]=c)}return this._setLength(f+1),f},b.prototype._setProxyHandlers=function(a,b){var c=this._length();if(c>=262138&&(c=0,this._setLength(0)),0===c)this._promise0=b,this._receiver0=a;else{var d=5*c-5;this[d+3]=b,this[d+4]=a}this._setLength(c+1)},b.prototype._proxyPromiseArray=function(a,b){this._setProxyHandlers(a,b)},b.prototype._setBoundTo=function(a){void 0!==a?(this._bitField=8388608|this._bitField,this._boundTo=a):this._bitField=-8388609&this._bitField},b.prototype._isBound=function(){return 8388608===(8388608&this._bitField)},b.prototype._resolveFromResolver=function(a){var b=this;this._setTrace(void 0),this._pushContext();var c=u(a,void 0,function(a){b._tryFollow(a)||b._fulfill(a)},function(a){var c=D(a)?a:new Error(g.toString(a));b._attachExtraTrace(c),C(a),b._reject(a,c===a?void 0:c)});if(this._popContext(),void 0!==c&&c===s){var d=c.e,e=D(d)?d:new Error(g.toString(d));b._reject(d,e)}},b.prototype._callHandler=function(a,b,c,d){var e;return c._pushContext(),e=b!==k||this._isRejected()?t(a,b,d):v(a,d,this._boundTo),c._popContext(),e},b.prototype._settlePromiseFromHandler=function(a,c,d,f){if(!f._isRejected()){var h=this._callHandler(a,c,f,d);if(h===s||h===f||h===l){var i=h===f?e():h.e,j=D(i)?i:new Error(g.toString(i));h!==l&&f._attachExtraTrace(j),f._rejectUnchecked(i,j)}else if(h=m(h,f),h instanceof b){if(h=h._target(),h._isRejected()&&!h._isCarryingStackTrace()&&!D(h._reason())){var j=new Error(g.toString(h._reason()));f._attachExtraTrace(j),h._setCarriedStackTrace(j)}f._follow(h)}else f._fulfillUnchecked(h)}},b.prototype._target=function(){for(var a=this;a._isFollowing();)a=a._followee();return a},b.prototype._followee=function(){return this._rejectionHandler0},b.prototype._setFollowee=function(a){this._rejectionHandler0=a},b.prototype._follow=function(a){if(a._isPending()){for(var b=this._length(),c=0;b>c;++c)a._migrateCallbacks(this._fulfillmentHandlerAt(c),this._rejectionHandlerAt(c),this._progressHandlerAt(c),this._promiseAt(c),this._receiverAt(c));this._setFollowing(),this._setLength(0),this._setFollowee(a),this._propagateFrom(a,1)}else a._isFulfilled()?this._fulfillUnchecked(a._value()):this._rejectUnchecked(a._reason(),a._getCarriedStackTrace());a._isRejectionUnhandled()&&a._unsetRejectionIsUnhandled(),F&&!a._trace.hasParent()&&a._trace.setParent(this._trace)},b.prototype._tryFollow=function(a){if(this._isFollowingOrFulfilledOrRejected()||a===this)return!1;var c=m(a,this);return c instanceof b?(this._follow(c._target()),!0):!1},b.prototype._resetTrace=function(){F&&(this._trace=new o(this._peekContext()))},b.prototype._setTrace=function(a){if(F){var b=this._peekContext();void 0!==a&&a._trace.parent()===b?this._trace=a._trace:this._trace=new o(b)}return this},b.prototype._attachExtraTrace=function(a){F&&D(a)&&this._trace.attachExtraTrace(a)},b.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},b.prototype._propagateFrom=function(a,b){(1&b)>0&&a._cancellable()&&(this._setCancellable(),this._cancellationParent=a),(4&b)>0&&this._setBoundTo(a._boundTo),(2&b)>0&&this._setTrace(a)},b.prototype._fulfill=function(a){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(a)},b.prototype._reject=function(a,b){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(a,b)},b.prototype._settlePromiseAt=function(a){var c=this._promiseAt(a),d=c instanceof b;if(d&&c._isMigrated())return c._unsetIsMigrated(),h.invoke(this._settlePromiseAt,this,a);var e=this._isFulfilled()?this._fulfillmentHandlerAt(a):this._rejectionHandlerAt(a),f=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,g=this._settledValue,i=this._receiverAt(a);this._clearCallbackDataAtIndex(a),"function"==typeof e?d?this._settlePromiseFromHandler(e,i,g,c):e.call(i,g,c):i instanceof n?i._isResolved()||(this._isFulfilled()?i._promiseFulfilled(g,c):i._promiseRejected(g,c)):this._isFulfilled()?c._fulfill(g):c._reject(g,f),a>=4&&4===(31&a)&&h.invokeLater(this._setLength,this,0)},b.prototype._clearCallbackDataAtIndex=function(a){if(0===a)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var b=5*a-5;this[b+3]=this[b+4]=this[b+0]=this[b+1]=this[b+2]=void 0}},b.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},b.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},b.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},b.prototype._queueSettlePromises=function(){this._isSettlePromisesQueued()||(h.invoke(this._settlePromises,this,void 0),this._setSettlePromisesQueued())},b.prototype._fulfillUnchecked=function(a){if(a===this){var b=e();return this._attachExtraTrace(b),this._rejectUnchecked(b,void 0)}this._setFulfilled(),this._settledValue=a,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},b.prototype._rejectUncheckedCheckError=function(a){var b=D(a)?a:new Error(g.toString(a));this._rejectUnchecked(a,b===a?void 0:b)},b.prototype._rejectUnchecked=function(a,b){if(a===this){var c=e();return this._attachExtraTrace(c),this._rejectUnchecked(c)}return this._setRejected(),this._settledValue=a,this._cleanValues(),this._isFinal()?void h.throwLater(function(a){throw"stack"in a&&h.invokeFirst(o.unhandledRejection,void 0,a),a},void 0===b?a:b):(void 0!==b&&this._setCarriedStackTrace(b),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},b.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var a=this._length(),b=0;a>b;b++)this._settlePromiseAt(b)},b.prototype._ensurePossibleRejectionHandled=function(){this._setRejectionIsUnhandled(),void 0!==o.possiblyUnhandledRejection&&h.invokeLater(this._notifyUnhandledRejection,this,void 0)},b.prototype._notifyUnhandledRejectionIsHandled=function(){"function"==typeof d&&h.throwLater(d,this)},b.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var a=this._settledValue,b=this._getCarriedStackTrace();this._setUnhandledRejectionIsNotified(),void 0!==b&&(this._unsetCarriedStackTrace(),a=b),"function"==typeof o.possiblyUnhandledRejection&&o.possiblyUnhandledRejection(a,this)}};var G=[];return b.prototype._peekContext=function(){var a=G.length-1;return a>=0?G[a]:void 0},b.prototype._pushContext=function(){F&&G.push(this._trace)},b.prototype._popContext=function(){F&&G.pop()},b.prototype._resolveFromSyncValue=function(a){if(a===s){this._setRejected();var c=a.e;this._settledValue=c,this._cleanValues(),this._attachExtraTrace(c),this._ensurePossibleRejectionHandled()}else{var d=m(a,this);d instanceof b?(d=d._target(),this._follow(d)):(this._setFulfilled(),this._settledValue=a,this._cleanValues())}},o.isSupported()||(b.longStackTraces=function(){},F=!1),b._makeSelfResolutionError=e,a("./finally.js")(b,l,m),a("./direct_resolve.js")(b),a("./synchronous_inspection.js")(b),a("./join.js")(b,n,m,j),b.RangeError=w,b.CancellationError=y,b.TimeoutError=z,b.TypeError=x,b.OperationalError=A,b.RejectionError=A,b.AggregateError=i.AggregateError,g.toFastProperties(b),g.toFastProperties(b.prototype),b.Promise=b,o.setBounds(h.firstLineError,g.lastLineError),a("./timers.js")(b,j,m),a("./race.js")(b,j,m),a("./call_get.js")(b),a("./generators.js")(b,E,j,m),a("./map.js")(b,n,E,m,j),a("./nodeify.js")(b),a("./promisify.js")(b,j),a("./props.js")(b,n,m),a("./reduce.js")(b,n,E,m,j),a("./settle.js")(b,n),a("./some.js")(b,n,E),a("./progress.js")(b,n),a("./cancel.js")(b,j),a("./filter.js")(b,j),a("./any.js")(b,n),a("./each.js")(b,j),a("./using.js")(b,E,m),b.prototype=b.prototype,b}}).call(this,a("_process"))},{"./any.js":2,"./async.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./direct_resolve.js":9,"./each.js":10,"./errors.js":11,"./errors_api_rejection":12,"./filter.js":14,"./finally.js":15,"./generators.js":16,"./join.js":17,"./map.js":18,"./nodeify.js":19,"./progress.js":20,"./promise_array.js":22,"./promise_resolver.js":23,"./promisify.js":24,"./props.js":25,"./race.js":27,"./reduce.js":28,"./settle.js":30,"./some.js":31,"./synchronous_inspection.js":32,"./thenables.js":33,"./timers.js":34,"./using.js":35,"./util.js":36,_process:40}],22:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){switch(a){case-1:return void 0;case-2:return[];case-3:return{}}}function f(a){var d,e=this._promise=new b(c);a instanceof b&&(d=a,e._propagateFrom(d,5)),e._setTrace(d),this._values=a,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var g=a("./errors.js").canAttachTrace,h=a("./util.js"),i=h.isArray;return f.prototype.length=function(){return this._length},f.prototype.promise=function(){return this._promise},f.prototype._init=function j(a,c){var f=d(this._values,void 0);if(f instanceof b){if(f._setBoundTo(this._promise._boundTo),f=f._target(),this._values=f,!f._isFulfilled())return f._isPending()?void f._then(j,this._reject,void 0,this,c):(f._unsetRejectionIsUnhandled(),void this._reject(f._reason()));if(f=f._value(),!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(g)}}else if(!i(f)){var g=new b.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(g)}if(0===f.length)return void(-5===c?this._resolveEmptyArray():this._resolve(e(c)));var h=this.getActualLength(f.length);this._length=h,this._values=this.shouldCopyValues()?new Array(h):this._values;for(var k=this._promise,l=0;h>l;++l){if(this._isResolved())return;var m=d(f[l],k);m instanceof b?(m=m._target(),m._isPending()?m._proxyPromiseArray(this,l):m._isFulfilled()?this._promiseFulfilled(m._value(),l):(m._unsetRejectionIsUnhandled(),this._promiseRejected(m._reason(),l))):this._promiseFulfilled(m,l)}},f.prototype._isResolved=function(){return null===this._values},f.prototype._resolve=function(a){this._values=null,this._promise._fulfill(a)},f.prototype.__hardReject__=f.prototype._reject=function(a){this._values=null;var b=g(a)?a:new Error(h.toString(a));this._promise._attachExtraTrace(b),this._promise._reject(a,b)},f.prototype._promiseProgressed=function(a,b){this._promise._progress({index:b,value:a})},f.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},f.prototype._promiseRejected=function(a,b){this._totalResolved++,this._reject(a)},f.prototype.shouldCopyValues=function(){return!0},f.prototype.getActualLength=function(a){return a},f}},{"./errors.js":11,"./util.js":36}],23:[function(a,b,c){"use strict";function d(a){return a instanceof Error&&o.getPrototypeOf(a)===Error.prototype}function e(a){var b;return b=d(a)?new l(a):a,j.markAsOriginatingFromRejection(b),b}function f(a){return function(b,c){if(null!==a){if(b){var d=e(i(b));a._attachExtraTrace(d),a._reject(d)}else if(arguments.length>2){for(var f=arguments.length,g=new Array(f-1),h=1;f>h;++h)g[h-1]=arguments[h];a._fulfill(g)}else a._fulfill(c);a=null}}}var g,h=a("./util.js"),i=h.maybeWrapAsError,j=a("./errors.js"),k=j.TimeoutError,l=j.OperationalError,m=a("./async.js"),n=h.haveGetters,o=a("./es5.js");if(g=n?function(a){this.promise=a}:function(a){this.promise=a,this.asCallback=f(a),this.callback=this.asCallback},n){var p={get:function(){return f(this.promise)}};o.defineProperty(g.prototype,"asCallback",p),o.defineProperty(g.prototype,"callback",p)}g._nodebackForPromise=f,g.prototype.toString=function(){return"[object PromiseResolver]"},g.prototype.resolve=g.prototype.fulfill=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");var b=this.promise;b._tryFollow(a)||m.invoke(b._fulfill,b,a)},g.prototype.reject=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");var b=this.promise;j.markAsOriginatingFromRejection(a);var c=j.canAttachTrace(a)?a:new Error(h.toString(a));b._attachExtraTrace(c),m.invoke(b._reject,b,a),c!==a&&m.invoke(this._setCarriedStackTrace,this,c)},g.prototype.progress=function(a){if(!(this instanceof g))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");m.invoke(this.promise._progress,this.promise,a)},g.prototype.cancel=function(){m.invoke(this.promise.cancel,this.promise,void 0)},g.prototype.timeout=function(){this.reject(new k("timeout"))},g.prototype.isResolved=function(){return this.promise.isResolved()},g.prototype.toJSON=function(){return this.promise.toJSON()},g.prototype._setCarriedStackTrace=function(a){this.promise.isRejected()&&this.promise._setCarriedStackTrace(a)},b.exports=g},{"./async.js":3,"./errors.js":11,"./es5.js":13,"./util.js":36}],24:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a){return a.replace(/([$])/,"\\$")}function e(a){try{return a.__isPromisified__===!0}catch(b){return!1}}function f(a,b,c){var d=s.getDataPropertyOrDefault(a,b+c,A);return d?e(d):!1}function g(a,b,c){for(var d=0;d<a.length;d+=2){var e=a[d];if(c.test(e))for(var f=e.replace(c,""),g=0;g<a.length;g+=2)if(a[g]===f)throw new x("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",b))}}function h(a,b,c,d){for(var h=s.inheritedDataKeys(a),i=[],j=0;j<h.length;++j){var k=h[j],l=a[k];"function"!=typeof l||e(l)||f(a,k,b)||!d(k,l,a)||i.push(k,l)}return g(i,b,c),i}function i(a){for(var b=[a],c=Math.max(0,a-1-5),d=a-1;d>=c;--d)d!==a&&b.push(d);for(var d=a+1;5>=d;++d)b.push(d);return b}function j(a){return s.filledRange(a,"arguments[","]")}function k(a){return s.filledRange(a,"_arg","")}function l(a){return"number"==typeof a.length?Math.max(Math.min(a.length,1024),0):0}function m(a){return s.isIdentifier(a)?"."+a:"['"+a.replace(/(['\\])/g,"\\$1")+"']"}function n(a,d,e,f,g){function h(b){var c,e=j(b).join(", "),f=b>0?", ":"";return c="string"==typeof a?"                                                          \n                this.method({{args}}, fn);                                   \n                break;                                                       \n            ".replace(".method",m(a)):d===r?"                                                         \n                callback.call(this, {{args}}, fn);                           \n                break;                                                       \n            ":void 0!==d?"                                                         \n                callback.call(receiver, {{args}}, fn);                       \n                break;                                                       \n            ":"                                                         \n                callback({{args}}, fn);                                      \n                break;                                                       \n            ",c.replace("{{args}}",e).replace(", ",f)}function n(){for(var b="",c=0;c<p.length;++c)b+="case "+p[c]+":"+h(p[c]);var e;return e="string"==typeof a?"                                                  \n                this.property.apply(this, args);                             \n            ".replace(".property",m(a)):d===r?"                                                  \n                callback.apply(this, args);                                  \n            ":"                                                  \n                callback.apply(receiver, args);                              \n            ",b+="                                                             \n        default:                                                             \n            var args = new Array(len + 1);                                   \n            var i = 0;                                                       \n            for (var i = 0; i < len; ++i) {                                  \n               args[i] = arguments[i];                                       \n            }                                                                \n            args[i] = fn;                                                    \n            [CodeForCall]                                                    \n            break;                                                           \n        ".replace("[CodeForCall]",e)}var o=Math.max(0,l(f)-1),p=i(o),q="string"==typeof e&&s.isIdentifier(e)?e+g:"promisified";return new Function("Promise","callback","receiver","withAppended","maybeWrapAsError","nodebackForPromise","INTERNAL","                                         \n        var ret = function (Parameters) {                        \n            'use strict';                                                    \n            var len = arguments.length;                                      \n            var promise = new Promise(INTERNAL);                             \n            promise._setTrace(undefined);                                    \n            var fn = nodebackForPromise(promise);                            \n            try {                                                            \n                switch(len) {                                                \n                    [CodeForSwitchCase]                                      \n                }                                                            \n            } catch (e) {                                                    \n                var wrapped = maybeWrapAsError(e);                           \n                promise._attachExtraTrace(wrapped);                          \n                promise._reject(wrapped);                                    \n            }                                                                \n            return promise;                                                  \n        };                                                                   \n        ret.__isPromisified__ = true;                                        \n        return ret;                                                          \n        ".replace("FunctionName",q).replace("Parameters",k(o)).replace("[CodeForSwitchCase]",n()))(b,a,d,u,v,t,c)}function o(a,d){function e(){var e=d;d===r&&(e=this),"string"==typeof a&&(a=e[a]);var f=new b(c);f._setTrace(void 0);var g=t(f);try{a.apply(e,u(arguments,g))}catch(h){var i=v(h);f._attachExtraTrace(i),f._reject(i)}return f}return e.__isPromisified__=!0,e}function p(a,b,c,e){for(var f=new RegExp(d(b)+"$"),g=h(a,b,f,c),i=0,j=g.length;j>i;i+=2){var k=g[i],l=g[i+1],m=k+b;a[m]=e===B?B(k,r,k,l,b):e(l)}return s.toFastProperties(a),a}function q(a,b){return B(a,b,void 0,a)}var r={},s=a("./util.js"),t=a("./promise_resolver.js")._nodebackForPromise,u=s.withAppended,v=s.maybeWrapAsError,w=s.canEvaluate,x=a("./errors").TypeError,y="Async",z=function(a,b){return s.isIdentifier(a)&&"_"!==a.charAt(0)&&!s.isClass(b)},A={__isPromisified__:!0},B=w?n:o;b.promisify=function(a,b){if("function"!=typeof a)throw new x("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return e(a)?a:q(a,arguments.length<2?r:b)},b.promisifyAll=function(a,b){if("function"!=typeof a&&"object"!=typeof a)throw new x("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");b=Object(b);var c=b.suffix;"string"!=typeof c&&(c=y);var d=b.filter;"function"!=typeof d&&(d=z);var e=b.promisifier;if("function"!=typeof e&&(e=B),!s.isIdentifier(c))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var f=s.inheritedDataKeys(a,{includeHidden:!0}),g=0;g<f.length;++g){var h=a[f[g]];"constructor"!==f[g]&&s.isClass(h)&&(p(h.prototype,c,d,e),p(h,c,d,e))}return p(a,c,d,e)}}},{"./errors":11,"./promise_resolver.js":23,"./util.js":36}],25:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){for(var b=j.keys(a),c=b.length,d=new Array(2*c),e=0;c>e;++e){var f=b[e];d[e]=a[f],d[e+c]=f}this.constructor$(d)}function f(a){var c,f=d(a,void 0);return i(f)?(c=f instanceof b?f._then(b.props,void 0,void 0,void 0,void 0):new e(f).promise(),f instanceof b&&c._propagateFrom(f,4),c):h("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var g=a("./util.js"),h=a("./errors_api_rejection")(b),i=g.isObject,j=a("./es5.js");g.inherits(e,c),e.prototype._init=function(){this._init$(void 0,-3)},e.prototype._promiseFulfilled=function(a,b){this._values[b]=a;var c=++this._totalResolved;if(c>=this._length){for(var d={},e=this.length(),f=0,g=this.length();g>f;++f)d[this._values[f+e]]=this._values[f];this._resolve(d)}},e.prototype._promiseProgressed=function(a,b){this._promise._progress({key:this._values[b+this.length()],value:a})},e.prototype.shouldCopyValues=function(){return!1},e.prototype.getActualLength=function(a){return a>>1},b.prototype.props=function(){return f(this)},b.props=function(a){return f(a)}}},{"./errors_api_rejection":12,"./es5.js":13,"./util.js":36}],26:[function(a,b,c){"use strict";function d(a,b,c,d,e){for(var f=0;e>f;++f)c[f+d]=a[f+b]}function e(a){this._capacity=a,this._length=0,this._front=0,this._makeCapacity()}e.prototype._willBeOverCapacity=function(a){return this._capacity<a},e.prototype._pushOne=function(a){var b=this.length();this._checkCapacity(b+1);var c=this._front+b&this._capacity-1;this[c]=a,this._length=b+1},e.prototype._unshiftOne=function(a){var b=this._capacity;this._checkCapacity(this.length()+1);var c=this._front,d=(c-1&b-1^b)-b;this[d]=a,this._front=d,this._length=this.length()+1},e.prototype.unshift=function(a,b,c){this._unshiftOne(c),this._unshiftOne(b),this._unshiftOne(a)},e.prototype.push=function(a,b,c){var d=this.length()+3;if(this._willBeOverCapacity(d))return this._pushOne(a),this._pushOne(b),void this._pushOne(c);var e=this._front+d-3;this._checkCapacity(d);var f=this._capacity-1;this[e+0&f]=a,this[e+1&f]=b,this[e+2&f]=c,this._length=d},e.prototype.shift=function(){var a=this._front,b=this[a];return this[a]=void 0,this._front=a+1&this._capacity-1,this._length--,b},e.prototype.length=function(){return this._length},e.prototype._makeCapacity=function(){for(var a=this._capacity,b=0;a>b;++b)this[b]=void 0},e.prototype._checkCapacity=function(a){this._capacity<a&&this._resizeTo(this._capacity<<3)},e.prototype._resizeTo=function(a){var b=this._front,c=this._capacity,e=new Array(c),f=this.length();if(d(this,0,e,0,c),this._capacity=a,this._makeCapacity(),this._front=0,c>=b+f)d(e,b,this,0,f);else{var g=f-(b+f&c-1);d(e,b,this,0,g),d(e,0,this,g,f-g)}},b.exports=e},{}],27:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a,e){var i=d(a,void 0);if(i instanceof b)return h(i);if(!g(a))return f("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var j=new b(c);void 0!==e?j._propagateFrom(e,7):j._setTrace(void 0);for(var k=j._fulfill,l=j._reject,m=0,n=a.length;n>m;++m){var o=a[m];(void 0!==o||m in a)&&b.cast(o)._then(k,l,void 0,j,null)}return j}var f=a("./errors_api_rejection.js")(b),g=a("./util.js").isArray,h=function(a){return a.then(function(b){return e(b,a)})};b.race=function(a){return e(a,void 0)},b.prototype.race=function(){return e(this,void 0)}}},{"./errors_api_rejection.js":12,"./util.js":36}],28:[function(a,b,c){"use strict";b.exports=function(b,c,d,e,f){function g(a,c,d,g){this.constructor$(a),this._preservedValues=g===f?[]:null,this._zerothIsAccum=void 0===d,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var h=e(d,void 0),i=!1,j=h instanceof b;j&&(h=h._target(),h._isPending()?h._proxyPromiseArray(this,-1):h._isFulfilled()?(d=h._value(),this._gotAccum=!0):(h._unsetRejectionIsUnhandled(),this._reject(h._reason()),i=!0)),j||this._zerothIsAccum||(this._gotAccum=!0),this._callback=c,this._accum=d,i||this._init$(void 0,-5)}function h(a,b,c,e){if("function"!=typeof b)return d("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var f=new g(a,b,c,e);return f.promise()}var i=a("./util.js"),j=i.tryCatch4,k=i.tryCatch3,l=i.errorObj;i.inherits(g,c),g.prototype._init=function(){},g.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},g.prototype._promiseFulfilled=function(a,c){var d=this._values;d[c]=a;var f,g=this.length(),h=this._preservedValues,i=null!==h,m=this._gotAccum,n=this._valuesPhase;if(!n)for(n=this._valuesPhase=Array(g),f=0;g>f;++f)n[f]=0;if(f=n[c],0===c&&this._zerothIsAccum?(m||(this._accum=a,this._gotAccum=m=!0),n[c]=0===f?1:2):-1===c?m||(this._accum=a,this._gotAccum=m=!0):0===f?n[c]=1:(n[c]=2,m&&(this._accum=a)),m){for(var o,p=this._callback,q=this._promise._boundTo,r=this._reducingIndex;g>r;++r)if(f=n[r],2!==f){if(1!==f)return;if(a=d[r],a instanceof b){if(a=a._target(),!a._isFulfilled())return a._isPending()?void 0:(a._unsetRejectionIsUnhandled(),this._reject(a._reason()));a=a._value()}if(i?(h.push(a),o=k(p,q,a,r,g)):o=j(p,q,this._accum,a,r,g),o===l)return this._reject(o.e);var s=e(o,this._promise);if(s instanceof b){if(s=s._target(),s._isPending())return n[r]=4,s._proxyPromiseArray(this,r);if(!s._isFulfilled())return s._unsetRejectionIsUnhandled(),this._reject(s._reason());o=s._value()}this._reducingIndex=r+1,this._accum=o}else this._reducingIndex=r+1;this._reducingIndex<g||this._resolve(i?h:this._accum)}},b.prototype.reduce=function(a,b){return h(this,a,b,null)},b.reduce=function(a,b,c,d){return h(a,b,c,d)}}},{"./util.js":36}],29:[function(a,b,c){(function(a){"use strict";var c,d;"object"==typeof a&&"string"==typeof a.version?c=function(b){a.nextTick(b)}:"undefined"!=typeof MutationObserver&&(d=MutationObserver)||"undefined"!=typeof WebKitMutationObserver&&(d=WebKitMutationObserver)?(c=function(a){var b=document.createElement("div"),c=new d(a);return c.observe(b,{attributes:!0}),function(){b.classList.toggle("foo")}},c.isStatic=!0):c="undefined"!=typeof setTimeout?function(a){setTimeout(a,0)}:function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")},b.exports=c}).call(this,a("_process"))},{_process:40}],30:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a){this.constructor$(a)}var e=b.PromiseInspection,f=a("./util.js");f.inherits(d,c),d.prototype._promiseResolved=function(a,b){this._values[a]=b;var c=++this._totalResolved;c>=this._length&&this._resolve(this._values)},d.prototype._promiseFulfilled=function(a,b){var c=new e;c._bitField=268435456,c._settledValue=a,this._promiseResolved(b,c)},d.prototype._promiseRejected=function(a,b){var c=new e;c._bitField=134217728,c._settledValue=a,this._promiseResolved(b,c)},b.settle=function(a){return new d(a).promise()},b.prototype.settle=function(){return new d(this).promise()}}},{"./util.js":36}],31:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){this.constructor$(a),this._howMany=0,this._unwrap=!1,this._initialized=!1}function f(a,b){if((0|b)!==b||0>b)return d("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var c=new e(a),f=c.promise();return f.isRejected()?f:(c.setHowMany(b),c.init(),f)}var g=a("./util.js"),h=a("./errors.js").RangeError,i=a("./errors.js").AggregateError,j=g.isArray;g.inherits(e,c),e.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var a=j(this._values);!this._isResolved()&&a&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},e.prototype.init=function(){this._initialized=!0,this._init()},e.prototype.setUnwrap=function(){this._unwrap=!0},e.prototype.howMany=function(){return this._howMany},e.prototype.setHowMany=function(a){this._isResolved()||(this._howMany=a)},e.prototype._promiseFulfilled=function(a){this._addFulfilled(a),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},e.prototype._promiseRejected=function(a){if(this._addRejected(a),this.howMany()>this._canPossiblyFulfill()){for(var b=new i,c=this.length();c<this._values.length;++c)b.push(this._values[c]);this._reject(b)}},e.prototype._fulfilled=function(){return this._totalResolved},e.prototype._rejected=function(){return this._values.length-this.length()},e.prototype._addRejected=function(a){this._values.push(a)},e.prototype._addFulfilled=function(a){this._values[this._totalResolved++]=a},e.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},e.prototype._getRangeError=function(a){var b="Input array must contain at least "+this._howMany+" items but contains only "+a+" items";return new h(b)},e.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},b.some=function(a,b){return f(a,b)},b.prototype.some=function(a){return f(this,a)},b._SomePromiseArray=e}},{"./errors.js":11,"./util.js":36}],32:[function(a,b,c){"use strict";b.exports=function(a){function b(a){void 0!==a?(a=a._target(),this._bitField=a._bitField,this._settledValue=a._isResolved()?a._settledValue:void 0):(this._bitField=0,this._settledValue=void 0)}b.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},b.prototype.error=b.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},b.prototype.isFulfilled=a.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},b.prototype.isRejected=a.prototype._isRejected=function(){return(134217728&this._bitField)>0},b.prototype.isPending=a.prototype._isPending=function(){return 0===(402653184&this._bitField)},b.prototype.isResolved=a.prototype._isResolved=function(){return(402653184&this._bitField)>0},a.prototype.isPending=function(){return this._target()._isPending()},a.prototype.isRejected=function(){return this._target()._isRejected()},a.prototype.isFulfilled=function(){return this._target()._isFulfilled()},a.prototype.isResolved=function(){return this._target()._isResolved()},a.prototype._value=function(){return this._settledValue},a.prototype._reason=function(){return this._settledValue},a.prototype.value=function(){var a=this._target();if(!a.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");
return a._settledValue},a.prototype.reason=function(){var a=this._target();if(!a.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return a._settledValue},a.PromiseInspection=b}},{}],33:[function(a,b,c){"use strict";b.exports=function(b,c){function d(a){try{return a.then}catch(b){return j.e=b,j}}function e(a,e){if(k(a)){if(a instanceof b)return a;if(f(a)){var h=new b(c);return h._setTrace(void 0),a._then(h._fulfillUnchecked,h._rejectUncheckedCheckError,h._progressUnchecked,h,null),h}var l=d(a);if(l===j)return void 0!==e&&i(l.e)&&e._attachExtraTrace(l.e),b.reject(l.e);if("function"==typeof l)return g(a,l,e)}return a}function f(a){return l.call(a,"_promise0")}function g(a,c,d){function e(c){if(!k){if(k=!0,a===c){var e=b._makeSelfResolutionError();return void 0!==d&&d._attachExtraTrace(e),void j.promise._reject(e,void 0)}j.resolve(c)}}function f(a){if(!k){k=!0;var b=i(a)?a:new Error(h.toString(a));void 0!==d&&d._attachExtraTrace(b),j.promise._reject(a,b)}}function g(a){if(!k){var b=j.promise;"function"==typeof b._progress&&b._progress(a)}}var j=b.defer(),k=!1;try{c.call(a,e,f,g)}catch(l){if(!k){k=!0;var m=i(l)?l:new Error(h.toString(l));void 0!==d&&d._attachExtraTrace(m),j.promise._reject(l,m)}}return j.promise}var h=a("./util.js"),i=a("./errors.js").canAttachTrace,j=h.errorObj,k=h.isObject,l={}.hasOwnProperty;return e}},{"./errors.js":11,"./util.js":36}],34:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){var b=this;return b instanceof Number&&(b=+b),clearTimeout(b),a}function f(a){var b=this;throw b instanceof Number&&(b=+b),clearTimeout(b),a}var g=(a("./util.js"),a("./errors.js")),h=(a("./errors_api_rejection")(b),b.TimeoutError),i=function(a,b){if(a.isPending()){"string"!=typeof b&&(b="operation timed out");var c=new h(b);g.markAsOriginatingFromRejection(c),a._attachExtraTrace(c),a._cancel(c)}},j=function(a,b){b._fulfill(a)},k=b.delay=function(a,e){void 0===e&&(e=a,a=void 0),e=+e;var f=d(a,void 0),g=new b(c);return f instanceof b?(g._propagateFrom(f,7),g._follow(f._target()),g.then(function(a){return b.delay(a,e)})):(g._setTrace(void 0),setTimeout(function(){j(a,g)},e),g)};b.prototype.delay=function(a){return k(this,a)},b.prototype.timeout=function(a,d){var g=this._target();a=+a;var h=new b(c).cancellable();h._propagateFrom(this,7),h._follow(g);var j=setTimeout(function(){i(h,d)},a);return h._then(e,f,void 0,j,void 0)}}},{"./errors.js":11,"./errors_api_rejection":12,"./util.js":36}],35:[function(a,b,c){"use strict";b.exports=function(b,c,d){function e(a){for(var c=a.length,d=0;c>d;++d){var e=a[d];if(e.isRejected())return b.reject(e.error());a[d]=e._settledValue}return a}function f(a){setTimeout(function(){throw a},0)}function g(a){var b=d(a,void 0);return b!==a&&"function"==typeof a._isDisposable&&"function"==typeof a._getDisposer&&a._isDisposable()&&b._setDisposable(a._getDisposer()),b}function h(a,c){function e(){if(h>=i)return j.resolve();var k=g(a[h++]);if(k instanceof b&&k._isDisposable()){try{k=d(k._getDisposer().tryDispose(c),void 0)}catch(l){return f(l)}if(k instanceof b)return k._then(e,f,null,null,null)}e()}var h=0,i=a.length,j=b.defer();return e(),j.promise}function i(a){var b=new o;return b._settledValue=a,b._bitField=268435456,h(this,b).thenReturn(a)}function j(a){var b=new o;return b._settledValue=a,b._bitField=134217728,h(this,b).thenThrow(a)}function k(a,b){this._data=a,this._promise=b}function l(a,b){this.constructor$(a,b)}var m=a("./errors.js").TypeError,n=a("./util.js").inherits,o=b.PromiseInspection;k.prototype.data=function(){return this._data},k.prototype.promise=function(){return this._promise},k.prototype.resource=function(){return this.promise()._isFulfilled()?this.promise()._value():null},k.prototype.tryDispose=function(a){var b=this.resource(),c=null!==b?this.doDispose(b,a):null;return this._promise._unsetDisposable(),this._data=this._promise=null,c},k.isDisposer=function(a){return null!=a&&"function"==typeof a.resource&&"function"==typeof a.tryDispose},n(l,k),l.prototype.doDispose=function(a,b){var c=this.data();return c.call(a,a,b)},b.using=function(){var a=arguments.length;if(2>a)return c("you must pass at least 2 arguments to Promise.using");var d=arguments[a-1];if("function"!=typeof d)return c("fn must be a function\n\n    See http://goo.gl/916lJJ\n");a--;for(var f=new Array(a),g=0;a>g;++g){var h=arguments[g];if(k.isDisposer(h)){var l=h;h=h.promise(),h._setDisposable(l)}f[g]=h}return b.settle(f).then(e).spread(d)._then(i,j,void 0,f,void 0)},b.prototype._setDisposable=function(a){this._bitField=262144|this._bitField,this._disposer=a},b.prototype._isDisposable=function(){return(262144&this._bitField)>0},b.prototype._getDisposer=function(){return this._disposer},b.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},b.prototype.disposer=function(a){if("function"==typeof a)return new l(a,this._target());throw new m}}},{"./errors.js":11,"./util.js":36}],36:[function(a,b,c){"use strict";function d(a,b,c){try{return a.call(b,c)}catch(d){return y.e=d,y}}function e(a,b,c,d){try{return a.call(b,c,d)}catch(e){return y.e=e,y}}function f(a,b,c,d,e){try{return a.call(b,c,d,e)}catch(f){return y.e=f,y}}function g(a,b,c,d,e,f){try{return a.call(b,c,d,e,f)}catch(g){return y.e=g,y}}function h(a,b,c){try{return a.apply(c,b)}catch(d){return y.e=d,y}}function i(a){return"string"==typeof a?a:""+a}function j(a){return null==a||a===!0||a===!1||"string"==typeof a||"number"==typeof a}function k(a){return!j(a)}function l(a){return j(a)?new Error(i(a)):a}function m(a,b){var c,d=a.length,e=new Array(d+1);for(c=0;d>c;++c)e[c]=a[c];return e[c]=b,e}function n(a,b,c){if(!v.isES5)return{}.hasOwnProperty.call(a,b)?a[b]:void 0;var d=Object.getOwnPropertyDescriptor(a,b);return null!=d?null==d.get&&null==d.set?d.value:c:void 0}function o(a,b,c){if(j(a))return a;var d={value:c,configurable:!0,enumerable:!1,writable:!0};return v.defineProperty(a,b,d),a}function p(a){throw a}function q(a){try{if("function"==typeof a){var b=v.keys(a.prototype);return b.length>0&&!(1===b.length&&"constructor"===b[0])}return!1}catch(c){return!1}}function r(a){function b(){}return b.prototype=a,b}function s(a){return C.test(a)}function t(a,b,c){for(var d=new Array(a),e=0;a>e;++e)d[e]=b+e+c;return d}function u(a){try{return a+""}catch(b){return"[no string representation]"}}var v=a("./es5.js"),w=function(){try{var a={};return v.defineProperty(a,"f",{get:function(){return 3}}),3===a.f}catch(b){return!1}}(),x="undefined"==typeof navigator,y={e:{}},z=function(a,b){function c(){this.constructor=a,this.constructor$=b;for(var c in b.prototype)d.call(b.prototype,c)&&"$"!==c.charAt(c.length-1)&&(this[c+"$"]=b.prototype[c])}var d={}.hasOwnProperty;return c.prototype=b.prototype,a.prototype=new c,a.prototype},A=function(){return"string"!==this}.call("string"),B=function(){return v.isES5?function(a,b){for(var c=[],d=Object.create(null),e=Object(b).includeHidden?Object.getOwnPropertyNames:Object.keys;null!=a;){var f;try{f=e(a)}catch(g){return c}for(var h=0;h<f.length;++h){var i=f[h];if(!d[i]){d[i]=!0;var j=Object.getOwnPropertyDescriptor(a,i);null!=j&&null==j.get&&null==j.set&&c.push(i)}}a=v.getPrototypeOf(a)}return c}:function(a){var b=[];for(var c in a)b.push(c);return b}}(),C=/^[a-z$_][a-z$_0-9]*$/i,D={isClass:q,isIdentifier:s,inheritedDataKeys:B,getDataPropertyOrDefault:n,thrower:p,isArray:v.isArray,haveGetters:w,notEnumerableProp:o,isPrimitive:j,isObject:k,canEvaluate:x,errorObj:y,tryCatch1:d,tryCatch2:e,tryCatch3:f,tryCatch4:g,tryCatchApply:h,inherits:z,withAppended:m,asString:i,maybeWrapAsError:l,wrapsPrimitiveReceiver:A,toFastProperties:r,filledRange:t,toString:u,lastLineError:new Error};b.exports=D},{"./es5.js":13}],37:[function(a,b,c){b.exports=a("./lib/enum")},{"./lib/enum":38}],38:[function(a,b,c){(function(a){!function(a,b,c,d){"use strict";function e(a,b){this.key=a,this.value=b}function f(a,b){function c(){for(var a=0,b=h.enums.length;b>a;a++){var c=h.enums[a];if(0===c.value||c.value&c.value-1)return!1}return!0}if(b&&"string"==typeof b&&(b={name:b}),this._options=b||{},this._options.separator=this._options.separator||" | ",this.enums=[],a.length){var d=a;a={};for(var f=0;f<d.length;f++)a[d[f]]=Math.pow(2,f)}for(var g in a){if(this._options.name&&"name"===g||"_options"===g||"get"===g||"getKey"===g||"getValue"===g||"enums"===g||"isFlaggable"===g)throw new Error('Enum key "'+g+'" is a reserved word!');this[g]=new e(g,a[g]),this.enums.push(this[g])}this._options.name&&(this.name=this._options.name);var h=this;this.isFlaggable=c()}e.prototype={has:function(a){return a instanceof e||"object"==typeof a&&void 0!==a.key&&void 0!==a.value?0!==(this.value&a.value):"string"==typeof a?this.key.indexOf(a)>=0:0!==(this.value&a)},is:function(a){return a instanceof e||"object"==typeof a&&void 0!==a.key&&void 0!==a.value?this.key===a.key:"string"==typeof a?this.key===a:this.value===a},toString:function(){return this.key},toJSON:function(){return this.key},valueOf:function(){return this.key}},f.prototype={getKey:function(a){var b=this.get(a);return b?b.key:"Undefined"},getValue:function(a){var b=this.get(a);return b?b.value:null},get:function(a){if(null===a||void 0===a)return null;if(a instanceof e||"object"==typeof a&&void 0!==a.key&&void 0!==a.value){var b=this.enums.indexOf(a);return b>=0?a:!this.isFlaggable||this.isFlaggable&&a.key.indexOf(this._options.separator)<0?null:this.get(a.key)}if("string"==typeof a){if(a.indexOf(this._options.separator)>0){for(var c=a.split(this._options.separator),d=0,f=0;f<c.length;f++){var g=c[f];d|=this[g].value}return new e(a,d)}return this[a]}for(var h in this)if(this.hasOwnProperty(h)&&this[h].value===a)return this[h];var i=null;if(this.isFlaggable)for(var j in this)this.hasOwnProperty(j)&&0!==(a&this[j].value)&&(i?i+=this._options.separator:i="",i+=j);return this.get(i||null)}},b&&b.exports?b.exports=f:d?d(function(){return f}):a.Enum=f,b&&b.exports&&c&&(f.register=function(a){a=a||"Enum",c[a]||(c[a]=f)})}(this,"undefined"!=typeof b?b:void 0,"undefined"!=typeof a?a:void 0,"undefined"!=typeof define?define:void 0)}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],39:[function(a,b,c){"use strict";var d=/[|\\{}()[\]^$+*?.]/g;b.exports=function(a){if("string"!=typeof a)throw new TypeError("Expected a string");return a.replace(d,"\\$&")}},{}],40:[function(a,b,c){function d(){}var e=b.exports={};e.nextTick=function(){var a="undefined"!=typeof window&&window.setImmediate,b="undefined"!=typeof window&&window.MutationObserver,c="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(a)return function(a){return window.setImmediate(a)};var d=[];if(b){var e=document.createElement("div"),f=new MutationObserver(function(){var a=d.slice();d.length=0,a.forEach(function(a){a()})});return f.observe(e,{attributes:!0}),function(a){d.length||e.setAttribute("yes","no"),d.push(a)}}return c?(window.addEventListener("message",function(a){var b=a.source;if((b===window||null===b)&&"process-tick"===a.data&&(a.stopPropagation(),d.length>0)){var c=d.shift();c()}},!0),function(a){d.push(a),window.postMessage("process-tick","*")}):function(a){setTimeout(a,0)}}(),e.title="browser",e.browser=!0,e.env={},e.argv=[],e.on=d,e.addListener=d,e.once=d,e.off=d,e.removeListener=d,e.removeAllListeners=d,e.emit=d,e.binding=function(a){throw new Error("process.binding is not supported")},e.cwd=function(){return"/"},e.chdir=function(a){throw new Error("process.chdir is not supported")}},{}],41:[function(a,b,c){function d(a,b,c){c&&f(a,b,c)&&(b=c=null);var d=null==a,i=null==b;if(null==c&&(i&&"boolean"==typeof a?(c=a,a=1):"boolean"==typeof b&&(c=b,i=!0)),d&&i&&(b=1,i=!1),a=+a||0,i?(b=a,a=0):b=+b||0,c||a%1||b%1){var j=h();return g(a+j*(b-a+parseFloat("1e-"+((j+"").length-1))),b)}return e(a,b)}var e=a("lodash._baserandom"),f=a("lodash._isiterateecall"),g=Math.min,h=Math.random;b.exports=d},{"lodash._baserandom":42,"lodash._isiterateecall":43}],42:[function(a,b,c){function d(a,b){return a+e(f()*(b-a+1))}var e=Math.floor,f=Math.random;b.exports=d},{}],43:[function(a,b,c){function d(a,b){return a=+a,b=null==b?h:b,a>-1&&a%1==0&&b>a}function e(a,b,c){if(!g(c))return!1;var e=typeof b;if("number"==e)var h=c.length,i=f(h)&&d(b,h);else i="string"==e&&b in c;return i&&c[b]===a}function f(a){return"number"==typeof a&&a>-1&&a%1==0&&h>=a}function g(a){var b=typeof a;return"function"==b||a&&"object"==b||!1}var h=Math.pow(2,53)-1;b.exports=e},{}],44:[function(a,b,c){function d(){d.init.call(this)}var e={};e.isObject=function(a){return"object"==typeof a&&null!==a},e.isNumber=function(a){return"number"==typeof a},e.isUndefined=function(a){return void 0===a},e.isFunction=function(a){return"function"==typeof a},b.exports=d,d.EventEmitter=d,d.prototype._events=void 0,d.prototype._maxListeners=void 0,d.defaultMaxListeners=10,d.init=function(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0},d.prototype.setMaxListeners=function(a){if(!e.isNumber(a)||0>a||isNaN(a))throw TypeError("n must be a positive number");return this._maxListeners=a,this},d.prototype.emit=function(a){var b,c,d,f,g,h;if(this._events||(this._events={}),"error"===a&&!this._events.error)throw b=arguments[1],b instanceof Error?b:Error('Uncaught, unspecified "error" event.');if(c=this._events[a],e.isUndefined(c))return!1;if(e.isFunction(c))switch(arguments.length){case 1:c.call(this);break;case 2:c.call(this,arguments[1]);break;case 3:c.call(this,arguments[1],arguments[2]);break;default:for(d=arguments.length,f=new Array(d-1),g=1;d>g;g++)f[g-1]=arguments[g];c.apply(this,f)}else if(e.isObject(c)){for(d=arguments.length,f=new Array(d-1),g=1;d>g;g++)f[g-1]=arguments[g];for(h=c.slice(),d=h.length,g=0;d>g;g++)h[g].apply(this,f)}return!0},d.prototype.addListener=function(a,b){var c;if(!e.isFunction(b))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",a,e.isFunction(b.listener)?b.listener:b),this._events[a]?e.isObject(this._events[a])?this._events[a].push(b):this._events[a]=[this._events[a],b]:this._events[a]=b,e.isObject(this._events[a])&&!this._events[a].warned){var c;c=e.isUndefined(this._maxListeners)?d.defaultMaxListeners:this._maxListeners,c&&c>0&&this._events[a].length>c&&(this._events[a].warned=!0,e.isFunction(console.error)&&console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[a].length),e.isFunction(console.trace)&&console.trace())}return this},d.prototype.on=d.prototype.addListener,d.prototype.once=function(a,b){function c(){this.removeListener(a,c),d||(d=!0,b.apply(this,arguments))}if(!e.isFunction(b))throw TypeError("listener must be a function");var d=!1;return c.listener=b,this.on(a,c),this},d.prototype.removeListener=function(a,b){var c,d,f,g;if(!e.isFunction(b))throw TypeError("listener must be a function");if(!this._events||!this._events[a])return this;if(c=this._events[a],f=c.length,d=-1,c===b||e.isFunction(c.listener)&&c.listener===b)delete this._events[a],this._events.removeListener&&this.emit("removeListener",a,b);else if(e.isObject(c)){for(g=f;g-->0;)if(c[g]===b||c[g].listener&&c[g].listener===b){d=g;break}if(0>d)return this;1===c.length?(c.length=0,delete this._events[a]):c.splice(d,1),this._events.removeListener&&this.emit("removeListener",a,b)}return this},d.prototype.removeAllListeners=function(a){var b,c;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[a]&&delete this._events[a],this;if(0===arguments.length){for(b in this._events)"removeListener"!==b&&this.removeAllListeners(b);return this.removeAllListeners("removeListener"),this._events={},this}if(c=this._events[a],e.isFunction(c))this.removeListener(a,c);else if(Array.isArray(c))for(;c.length;)this.removeListener(a,c[c.length-1]);return delete this._events[a],this},d.prototype.listeners=function(a){var b;return b=this._events&&this._events[a]?e.isFunction(this._events[a])?[this._events[a]]:this._events[a].slice():[]},d.listenerCount=function(a,b){var c;return c=a._events&&a._events[b]?e.isFunction(a._events[b])?1:a._events[b].length:0}},{}],45:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};e=a("bluebird"),b.exports=d=function(){function a(a){this.isOn=null!=a?a:!1,this._set=f(this._set,this),this.set=f(this.set,this),this.setOff=f(this.setOff,this),this.setOn=f(this.setOn,this),this._targetState=this.isOn,this._promise=e.resolve()}return a.prototype.setOn=function(a){return this.set(!0,a)},a.prototype.setOff=function(a){return this.set(!1,a)},a.prototype.set=function(a,b){var c;return c=function(c){return function(){return c._set(a,b)}}(this),this._promise=this._promise.then(c,c)},a.prototype._set=function(a,b){var c;return a===this._targetState?e.resolve():(this._targetState=a,c=null!=b?e.method(function(){return b()}):function(){return e.resolve()},c().tap(function(b){return function(){return b.isOn=a}}(this))["catch"](function(b){return function(c){throw b._targetState=!a,c}}(this)))},a}()},{bluebird:4}],46:[function(a,b,c){var d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}},l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};f=a("node-event-emitter"),j=a("bluebird"),g=j.Promise,h=j.TimeoutError,i=a("./WebSocketFactory"),d=a("../AsyncBinaryState"),b.exports=e=function(a){function b(a,b,c){this.url=a,this.connectTimeout=null!=b?b:3,this.webSocketFactory=null!=c?c:new i,this._message=k(this._message,this),this._close=k(this._close,this),this._closeDuringConnect=k(this._closeDuringConnect,this),this._open=k(this._open,this),this._send=k(this._send,this),this.send=k(this.send,this),this.disconnect=k(this.disconnect,this),this.connect=k(this.connect,this),this._state=new d,this._socket=null,this._connectionResolver=null}return m(b,a),b.prototype.connect=function(a){return null==a&&(a={}),this._connectPromise=this._state.setOn(function(b){return function(){var c;return b._connectionResolver=g.defer(),b._socket=b.webSocketFactory.create(b.url),b._socket.onopen=function(){return b._open(a)},b._socket.onclose=b._closeDuringConnect,c=Math.round(1e3*b.connectTimeout),b._connectionResolver.promise.timeout(c,"Connection timed out.")["catch"](h,function(a){throw b._socket.close(4001,"Connection handshake timed out."),a})}}(this))},b.prototype.disconnect=function(){var a;return a=g.defer(),this._state.setOff(function(b){return function(){return a.promise.tap(function(){return b.emit("disconnect",1e3,"Connection terminated by client.")})["catch"](function(){}),b._socket.onopen=function(){},b._socket.onclose=function(){},b._socket.onmessage=function(){},b._socket.close(),b._socket=null}}(this)),a.resolve(),a.promise},b.prototype.send=function(a){if(this._state.isOn)return this._send(a);throw new Error("Unable to send message. Not connected.")},b.prototype._send=function(a){return this._socket.send(JSON.stringify(a))},b.prototype._open=function(a){return this._socket.onmessage=this._message,this._send({type:"handshake.request",version:"1.0.0",request:a})},b.prototype._closeDuringConnect=function(){return this._connectionResolver.reject(new Error("Unable to connect to server.")),this._connectionResolver=null},b.prototype._close=function(a){return this._state.setOff(),this._socket=null,this.emit("disconnect",a.code,a.reason)},b.prototype._message=function(a){var b,c;try{c=JSON.parse(a.data)}catch(d){return b=d,this._socket.close(4001,"Invalid message received."),void this._state.setOff()}switch(c.type){case"handshake.approve":return this._connectPromise.then(function(a){return function(){return a.emit("connect",c.response)}}(this)),this._connectionResolver.resolve(c.response),this._connectionResolver=null,this._socket.onclose=this._close;case"handshake.reject":return this._connectionResolver.reject(new Error(c.reason)),this._connectionResolver=null,this._socket.onclose=null,this._socket=null,this._state.setOff();default:return this.emit("message",c),this.emit("message."+c.type,c)}},b}(f)},{"../AsyncBinaryState":45,"./WebSocketFactory":49,bluebird:4,"node-event-emitter":44}],47:[function(a,b,c){var d;b.exports=d=function(){function a(){}return a.prototype.buildRequest=function(){return{}},a.prototype.handleResponse=function(){},a}()},{}],48:[function(a,b,c){var d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}},k={}.hasOwnProperty,l=function(a,b){function c(){this.constructor=a}for(var d in b)k.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a},m=[].slice;d=a("../AsyncBinaryState"),e=a("node-event-emitter"),f=a("./HandshakeManager"),h=a("bluebird"),i=a("lodash.random"),b.exports=g=function(a){function b(a,b,c,e,g,h){this.connection=a,this.handshakeManager=null!=b?b:new f,this.reconnectWaitMin=null!=c?c:3,this.reconnectWaitMax=null!=e?e:5,this.reconnectLimit=null!=g?g:20,this.keepaliveWait=null!=h?h:30,this._message=j(this._message,this),this._handleReconnect=j(this._handleReconnect,this),this._reconnect=j(this._reconnect,this),this._disconnect=j(this._disconnect,this),this.send=j(this.send,this),this._state=new d,this._waitForConnectResolver=null}return l(b,a),b.prototype.connect=function(){return this._connect()},b.prototype.disconnect=function(){return this._state.setOff(function(a){return function(){return a.connection.removeListener("disconnect",a._reconnect),a._cancelReconnect(),a.connection.disconnect().then(function(){return a.connection.removeListener("message",a._message)})}}(this))},b.prototype._connect=function(a){return null==a&&(a=!1),this._state.setOn(function(b){return function(){var c;return c=h.method(function(){return b.handshakeManager.buildRequest()}),c().then(function(a){return b.connection.connect(a)})["catch"](function(c){throw a||b._reconnect(),c}).then(function(a){var c,d;return b.connection.on("message",b._message),b.connection.once("disconnect",b._disconnect),b.connection.once("disconnect",b._reconnect),c=function(){return b.send({type:"connection.heartbeat"})},d=Math.round(1e3*b.keepaliveWait),b._keepaliveInterval=setInterval(c,d),b.handshakeManager.handleResponse(a),b.emit("connect",a),null!=b._waitForConnectResolver&&b._waitForConnectResolver.resolve(a),a})["catch"](function(a){throw b.connection.removeListener("message",b._message),b.connection.removeListener("disconnect",b._disconnect),b.connection.removeListener("disconnect",b._reconnect),b.emit("error",a),a})}}(this))},b.prototype.send=function(a){return this.connection.send(a)},b.prototype.waitForConnect=function(){return null==this._waitForConnectResolver&&(this._waitForConnectResolver=h.defer(),this._state.isOn&&this._waitForConnectResolver.resolve()),this._waitForConnectResolver.promise},b.prototype._disconnect=function(){return this._waitForConnectResolver=null,clearInterval(this._keepaliveInterval),delete this._keepaliveInterval,this._state.setOff(),this.emit.apply(this,["disconnect"].concat(m.call(arguments)))},b.prototype._reconnect=function(){return null==this._reconnectTimeout?(this._reconnectCount=0,this._scheduleReconnect()):void 0},b.prototype._scheduleReconnect=function(){var a;return a=Math.round(1e3*i(this.reconnectWaitMin,this.reconnectWaitMax,!0)),this._reconnectTimeout=setTimeout(this._handleReconnect,a)},b.prototype._cancelReconnect=function(){return null!=this._reconnectTimeout?(clearTimeout(this._reconnectTimeout),delete this._reconnectTimeout):void 0},b.prototype._handleReconnect=function(){var a;return a=++this._reconnectCount>=this.reconnectLimit,a&&this._cancelReconnect(),this.emit("reconnect",this._reconnectCount),this._connect(!0).tap(function(a){return function(){return a._cancelReconnect()}}(this))["catch"](function(b){return function(c){return a?(null!=b._waitForConnectResolver&&b._waitForConnectResolver.reject(c),b.emit("reconnectFailure",c,b)):b._scheduleReconnect()}}(this))},b.prototype._message=function(a){return this.emit.apply(this,["message"].concat(m.call(arguments))),this.emit.apply(this,["message."+a.type].concat(m.call(arguments)))},b}(e)},{"../AsyncBinaryState":45,"./HandshakeManager":47,bluebird:4,"lodash.random":41,"node-event-emitter":44}],49:[function(a,b,c){var d;b.exports=d=function(){function a(a){this.webSocketClass=null!=a?a:WebSocket}return a.prototype.create=function(a,b){return new this.webSocketClass(a,b)},a}()},{}],50:[function(a,b,c){b.exports={Connection:a("./Connection"),HandshakeManager:a("./HandshakeManager"),PersistentConnection:a("./PersistentConnection"),WebSocketFactory:a("./WebSocketFactory")}},{"./Connection":46,"./HandshakeManager":47,"./PersistentConnection":48,"./WebSocketFactory":49}],51:[function(a,b,c){b.exports={connection:a("./connection"),pubsub:a("./pubsub"),rpc:a("./rpc"),AsyncBinaryState:a("./AsyncBinaryState")}},{"./AsyncBinaryState":45,"./connection":50,"./pubsub":55,"./rpc":63}],52:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}};b.exports=d=function(){function a(a){this.connection=a,this.publish=e(this.publish,this)}return a.prototype.publish=function(a,b){return this.connection.send({type:"pubsub.publish",topic:a,payload:b})},a}()},{}],53:[function(a,b,c){var d,e,f=function(a,b){return function(){return a.apply(b,arguments)}};e=a("./Subscription"),b.exports=d=function(){function a(a,b){this.connection=a,this.timeout=null!=b?b:3,this.subscribe=f(this.subscribe,this),this._id=0}return a.prototype.subscribe=function(a){return new e(this.connection,a,++this._id,this.timeout)},a}()},{"./Subscription":54}],54:[function(a,b,c){var d,e,f,g,h,i,j,k=function(a,b){return function(){return a.apply(b,arguments)}},l={}.hasOwnProperty,m=function(a,b){function c(){this.constructor=a}for(var d in b)l.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("../AsyncBinaryState"),e=a("node-event-emitter"),i=a("escape-string-regexp"),j=a("bluebird"),f=j.Promise,h=j.TimeoutError,b.exports=g=function(a){function b(a,b,c,e){var f,g;this.connection=a,this.topic=b,this.id=c,this.timeout=null!=e?e:3,this._removeListeners=k(this._removeListeners,this),this._disconnect=k(this._disconnect,this),this._publish=k(this._publish,this),this._subscribed=k(this._subscribed,this),this._state=new d,g=function(){var a,c,d,e;for(d=b.split("."),e=[],a=0,c=d.length;c>a;a++)switch(f=d[a]){case"*":e.push("(.+)");break;case"?":e.push("([^.]+)");break;default:e.push(i(f))}return e}(),this._pattern=new RegExp("^"+g.join(i("."))+"$")}return m(b,a),b.prototype.enable=function(){return this._state.setOn(function(a){return function(){var b,c;return b=new f(function(b){return a._resolve=b}),a.connection.on("message.pubsub.subscribed",a._subscribed),a.connection.on("message.pubsub.publish",a._publish),a.connection.on("disconnect",a._disconnect),a.connection.send({type:"pubsub.subscribe",id:a.id,topic:a.topic}),c=Math.round(1e3*a.timeout),b.timeout(c,"Subscription request timed out.")["catch"](h,function(b){throw a._removeListeners(),b})}}(this))},b.prototype.disable=function(){return this._state.setOff(function(a){return function(){return a.connection.send({type:"pubsub.unsubscribe",id:a.id}),a._removeListeners()}}(this))},b.prototype._subscribed=function(a){return a.id===this.id?this._resolve():void 0},b.prototype._publish=function(a){return this._pattern.test(a.topic)?this.emit("message",a.topic,a.payload):void 0},b.prototype._disconnect=function(){return this._state.setOff(this._removeListeners)},b.prototype._removeListeners=function(){return this.connection.removeListener("message.pubsub.subscribed",this._subscribed),this.connection.removeListener("message.pubsub.publish",this._publish),this.connection.removeListener("disconnect",this._disconnect)},b}(e)},{"../AsyncBinaryState":45,bluebird:4,"escape-string-regexp":39,"node-event-emitter":44}],55:[function(a,b,c){b.exports={Publisher:a("./Publisher"),Subscriber:a("./Subscriber")}},{"./Publisher":52,"./Subscriber":53}],56:[function(a,b,c){var d,e,f,g,h,i,j=function(a,b){return function(){return a.apply(b,arguments)}},k=[].slice;d=a("./error/InvalidMessageError"),e=a("bluebird"),f=a("./message/Request"),g=a("./message/Response"),h=a("./message/ResponseCode"),b.exports=i=function(){function a(a,b){this.connection=a,this.timeout=null!=b?b:3,this._recv=j(this._recv,this),this._send=j(this._send,this),this.invokeArray=j(this.invokeArray,this),this.invoke=j(this.invoke,this),this._requests={},this._id=0,this.connection.on("message.rpc.response",this._recv)}return a.prototype.invoke=function(){var a,b,c,d;return c=arguments[0],a=2<=arguments.length?k.call(arguments,1):[],b=(++this._id).toString(),d=new f(c,a),this._send(d,b).then(function(a){return function(a){return a.extract()}}(this))},a.prototype.invokeArray=function(a,b){return this.invoke.apply(this,[a].concat(k.call(b)))},a.prototype._send=function(a,b){var c,d;return c=new e(function(c){return function(d,e){return c._requests[b]={resolve:d,reject:e},c.connection.send({type:"rpc.request",id:b,name:a.name,arguments:a.arguments})}}(this)),d=Math.round(1e3*this.timeout),c.timeout(d,"RPC request timed out.")["finally"](function(a){return function(){return delete a._requests[b]}}(this))},a.prototype._recv=function(a){var b,c;if(null!=a.id&&null!=this._requests[a.id])return(b=h.get(a.code))?b!==h.SUCCESS&&"string"!=typeof a.value?(c=new d("Response error message must be a string."),this.connection.close(4001,c.message),this._requests[a.id].reject(c)):this._requests[a.id].resolve(new g(b,a.value)):(c=new d("Response code is unrecognised."),this.connection.close(4001,c.message),this._requests[a.id].reject(c))},a}()},{"./error/InvalidMessageError":59,"./message/Request":64,"./message/Response":65,"./message/ResponseCode":66,bluebird:4}],57:[function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("../message/ResponseCode"),b.exports=d=function(a){function b(a){this.message=a,this.responseCode=e.ERROR}return g(b,a),b}(Error)},{"../message/ResponseCode":66}],58:[function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("../message/ResponseCode"),b.exports=d=function(a){function b(a){this.message=a,this.responseCode=e.INVALID_ARGUMENTS}return g(b,a),b}(Error)},{"../message/ResponseCode":66}],59:[function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};e=a("../message/ResponseCode"),b.exports=d=function(a){function b(a){this.message=a,this.responseCode=e.INVALID_MESSAGE}return g(b,a),b}(Error)},{"../message/ResponseCode":66}],60:[function(a,b,c){var d,e={}.hasOwnProperty,f=function(a,b){function c(){this.constructor=a}for(var d in b)e.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};b.exports=d=function(a){function b(a){this.timeout=a,this.message="RPC call timed out after "+this.timeout+" seconds."}return f(b,a),b}(Error)},{}],61:[function(a,b,c){var d,e,f={}.hasOwnProperty,g=function(a,b){function c(){this.constructor=a}for(var d in b)f.call(b,d)&&(a[d]=b[d]);return c.prototype=b.prototype,a.prototype=new c,a.__super__=b.prototype,a};d=a("../message/ResponseCode"),b.exports=e=function(a){function b(a){this.procedureName=a,this.message="Unknown procedure: "+this.procedureName+".",this.responseCode=d.UNKNOWN_PROCEDURE}return g(b,a),b}(Error)},{"../message/ResponseCode":66}],62:[function(a,b,c){
b.exports={ExecutionError:a("./ExecutionError"),InvalidArgumentsError:a("./InvalidArgumentsError"),InvalidMessageError:a("./InvalidMessageError"),TimeoutError:a("./TimeoutError"),UnknownProcedureError:a("./UnknownProcedureError")}},{"./ExecutionError":57,"./InvalidArgumentsError":58,"./InvalidMessageError":59,"./TimeoutError":60,"./UnknownProcedureError":61}],63:[function(a,b,c){b.exports={error:a("./error"),message:a("./message"),RpcClient:a("./RpcClient")}},{"./RpcClient":56,"./error":62,"./message":67}],64:[function(a,b,c){var d,e=function(a,b){return function(){return a.apply(b,arguments)}};b.exports=d=function(){function a(a,b){this.name=a,this.arguments=b,this.toString=e(this.toString,this)}return a.prototype.toString=function(){return this.name+"("+this.arguments.map(JSON.stringify).join(", ")+")"},a}()},{}],65:[function(a,b,c){var d,e,f,g,h,i=function(a,b){return function(){return a.apply(b,arguments)}};d=a("../error/ExecutionError"),e=a("../error/InvalidMessageError"),g=a("./ResponseCode"),h=a("../error/UnknownProcedureError"),b.exports=f=function(){function a(a,b){this.code=a,this.value=b,this.toString=i(this.toString,this),this.extract=i(this.extract,this)}return a.prototype.extract=function(){if(this.code===g.SUCCESS)return this.value;if(this.code===g.INVALID_MESSAGE)throw new e(this.value);if(this.code===g.UNKNOWN_PROCEDURE)throw new h(this.value);throw new d(this.value)},a.prototype.toString=function(){var a;return a=this.code.is("SUCCESS")?JSON.stringify(this.value):this.value,this.code.key+"("+a+")"},a}()},{"../error/ExecutionError":57,"../error/InvalidMessageError":59,"../error/UnknownProcedureError":61,"./ResponseCode":66}],66:[function(a,b,c){var d;d=a("enum"),b.exports=new d({SUCCESS:0,ERROR:10,INVALID_MESSAGE:11,UNKNOWN_PROCEDURE:12,INVALID_ARGUMENTS:13})},{"enum":37}],67:[function(a,b,c){b.exports={Request:a("./Request"),Response:a("./Response"),ResponseCode:a("./ResponseCode")}},{"./Request":64,"./Response":65,"./ResponseCode":66}]},{},[45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,1]);
//# sourceMappingURL=demo.min.js.map